mutate(patient=with15) %>% add_clinical()
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
expcon_compare_categorical(rep4$data[[paste0(i,'-1')]],
rep4$data[[paste0(i,'-5')]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
mutate(Value=max(c1,c2)) %>%
plotBoxplot()
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
expcon_compare_categorical(rep4$data[[paste0(i,'-1')]],
rep4$data[[paste0(i,'-5')]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
mutate(Value=max(c1,c2)) %>%
plotBoxplot(value_col='Value')
map(with15,function(i){
expcon_compare_categorical(rep4$data[[paste0(i,'-1')]],
rep4$data[[paste0(i,'-5')]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
mutate(Value=max(c1,c2))
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
expcon_compare_categorical(rep4$data[[paste0(i,'-1')]],
rep4$data[[paste0(i,'-5')]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
rowwise() %>% mutate(Value=max(c1,c2)) %>%
plotBoxplot(value_col='Value')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
expcon_compare_categorical(rep4$data[[paste0(i,'-1')]],
rep4$data[[paste0(i,'-5')]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
rowwise() %>% mutate(Value=min(c1,c2)) %>%
plotBoxplot(value_col='Value')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
# rowwise() %>% mutate(Value=max(c1,c2)) %>%
rowwise() %>% mutate(Value=min(c1,c2)) %>%
plotBoxplot(value_col='Value')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
rowwise() %>% mutate(Value=max(c1,c2)) %>%
# rowwise() %>% mutate(Value=min(c1,c2)) %>%
plotBoxplot(value_col='Value')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
rowwise() %>% mutate(Value=max(c1,c2)) %>%
# rowwise() %>% mutate(Value=min(c1,c2)) %>%
plotBoxplot(value_col='Value')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
rowwise() %>% mutate(Value=max(c1,c2)) %>%
# rowwise() %>% mutate(Value=min(c1,c2)) %>%
plotBoxplot(value_col='Value')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
rowwise() %>% mutate(Value=c2) %>%
# rowwise() %>% mutate(Value=min(c1,c2)) %>%
plotBoxplot(value_col='Value')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
plotBoxplot(value_col='c2')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
plotBoxplot(value_col='c2')
# look specifically at TM
# need to look at tm pre and tm post; are post exp pre, novel
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
plotBoxplot(value_col='c2')
rep4$data[[1]]
rep4$data[[10]]
rep4$data[[30]]
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(!is.na(expTil)))
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil)))
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t()
# tm stuff
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil)))
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
plotBoxplot(value_col='c2')
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil)))
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical()
?repSample
install.packages('rsample')
?rsample::bootstraps()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
})
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.matrix()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.array()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.array() %>% colMeans()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.array()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% colMeans()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% dims()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% dim()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% rowMeans()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
mutate(patient=with15) %>% add_clinical()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical()
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>% group_by(clinical) %>% summarize(v=mean(c1))
# bootstrapped
h1 <- map_dfr(1:1000,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=mean(c1))
})
# bootstrapped
h1 <- map_dfr(1:100,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=mean(c1))
})
h1
dim(h1)
plotBoxplot(h1,'v')
# bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=median(c1))
})
plotBoxplot(h1,'v')
# bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=median(c2))
})
plotBoxplot(h1,'v')
# bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=mean(c2))
})
plotBoxplot(h1,'v')
# tm stuff
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil)))
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
plotBoxplot(value_col='c2')
df1 <- rep4$data$`14-1`
df2 <- rep4$data$`14-5`
left_join(
arrange(df1,desc(Clones)) %>% mutate(proportion1=proportions(Clones)) %>%
slice(1:n) %>% select(cdr3=CDR3.aa,proportion1),
mutate(df2,proportion2=proportions(Clones)) %>%
select(cdr3=CDR3.aa,proportion2),
by='cdr3'
)
n <- 10
left_join(
arrange(df1,desc(Clones)) %>% mutate(proportion1=proportions(Clones)) %>%
slice(1:n) %>% select(cdr3=CDR3.aa,proportion1),
mutate(df2,proportion2=proportions(Clones)) %>%
select(cdr3=CDR3.aa,proportion2),
by='cdr3'
)
expcon_overlap_rank <- function(df1,df2,n=25){
if((n<nrow(df1))|(n<nrow(df2))) warning('Clones less than n')
cdr3.1 <- arrange(df1,desc(Clones))$CDR3.aa[1:min(n,nrow(df1))]
cdr3.2 <- arrange(df2,desc(Clones))$CDR3.aa[1:min(n,nrow(df2))]
sum(cdr3.1 %in% cdr3.2)/length(unique(c(cdr3.1,cdr3.2)))
}
expcon_overlap_rank(df1,df2)
nrow(df1)
nrow(df2)
expcon_overlap_rank <- function(df1,df2,n=25){
if((n>nrow(df1))|(n>nrow(df2))) warning('Clones less than n')
cdr3.1 <- arrange(df1,desc(Clones))$CDR3.aa[1:min(n,nrow(df1))]
cdr3.2 <- arrange(df2,desc(Clones))$CDR3.aa[1:min(n,nrow(df2))]
sum(cdr3.1 %in% cdr3.2)/length(unique(c(cdr3.1,cdr3.2)))
}
nrow(df2)
expcon_overlap_rank(df1,df2)
expcon_overlap_rank(df1,df2)
# 1-5 overlap of expanded downsampled
map_dbl(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15) %>%
add_clinical()
# 1-5 overlap of expanded downsampled
map_dbl(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15) %>% add_clinical() %>%
plotBoxplot(value_col='value')
# bootstrapped
h1 <- map_dfr(1:50,function(ii){
map_dbl(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(value=mean(value))
})
plotBoxplot(h1,'value')
# bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=mean(c2))
})
plotBoxplot(h1,'v')
# bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=mean(c2,na.rm=T))
})
plotBoxplot(h1,'v')
# tm bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(value=mean(value))
})
plotBoxplot(h1,'v')
# tm bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(value=mean(value,na.rm=T))
})
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
})
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(value=mean(value,na.rm=T))
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15)
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
})
# tm bootstrapped
h1 <- map_dfr(1:50,function(ii){
map_dbl(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=25)
}) %>% data.frame('value'=.,patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(value=mean(value,na.rm=T))
})
plotBoxplot(h1,'v')
plotBoxplot(h1,'value')
# tm bootstrapped
h1 <- map_dfr(1:50,function(ii){
map_dbl(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_overlap_rank(x[[1]],x[[2]],n=15)
}) %>% data.frame('value'=.,patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(value=mean(value,na.rm=T))
})
plotBoxplot(h1,'value')
# bootstrapped
h1 <- map_dfr(1:50,function(ii){
map(with15,function(i){
x <- list(rep4$data[[paste0(i,'-1')]],rep4$data[[paste0(i,'-5')]]) %>%
map(~filter(.x,!is.na(expTil))) %>% repSample()
expcon_compare_categorical(x[[1]],x[[2]],overlap8=T)
}) %>% as.data.frame() %>% t() %>%
set_colnames(c('c1','c2')) %>% as_tibble() %>%
mutate(patient=with15) %>% add_clinical() %>%
group_by(clinical) %>% summarize(v=mean(c2,na.rm=T))
})
plotBoxplot(h1,'v')
knitr::opts_chunk$set(echo=F,message=F,warning=F,error=F)
knitr::opts_knit$set(root.dir=normalizePath('..'))
source('figures_source.r')
load_tcr()
dat <- load_main('tc')
require(ggprism)
knitr::opts_chunk$set(echo=F,message=F,warning=F)
source('figures_source.r')
load_tcr()
dat <- load_main('ldat')
require(ggprism)
# fine clusters
group_by(dat,patient,timepoint,cluster_fine) %>%
summarize(prop=mean(!is.na(expTil))) %>% add_clinical() %>% ungroup() %>%
group_by(clinical,cluster_fine) %>%
summarize(value=mean(prop),serr=sd(prop)/sqrt(n())) %>%
filter(clinical!='Healthy') %>%
ggplot(aes(clinical,value,fill=clinical,color=clinical)) %>%
prism()+geom_col()+
geom_errorbar(aes(ymax=value+serr,ymin=value-serr),width=0.2,lwd=1)+
facet_wrap(~cluster_fine,scales='free')+
theme(axis.text.x=element_blank())+ylab('Proportion tumor matching')
dat
dat <- load_main('tc')
# fine clusters
group_by(dat,patient,timepoint,cluster_fine) %>%
summarize(prop=mean(!is.na(expTil))) %>% add_clinical() %>% ungroup() %>%
group_by(clinical,cluster_fine) %>%
summarize(value=mean(prop),serr=sd(prop)/sqrt(n())) %>%
filter(clinical!='Healthy') %>%
ggplot(aes(clinical,value,fill=clinical,color=clinical)) %>%
prism()+geom_col()+
geom_errorbar(aes(ymax=value+serr,ymin=value-serr),width=0.2,lwd=1)+
facet_wrap(~cluster_fine,scales='free')+
theme(axis.text.x=element_blank())+ylab('Proportion tumor matching')
# coarse
group_by(dat,patient,timepoint,cluster_coarse) %>%
summarize(prop=mean(!is.na(expTil))) %>% add_clinical() %>% ungroup() %>%
group_by(clinical,cluster_coarse) %>%
summarize(value=mean(prop),serr=sd(prop)/sqrt(n())) %>%
filter(clinical!='Healthy') %>%
ggplot(aes(clinical,value,fill=clinical,color=clinical)) %>%
prism()+geom_col()+
geom_errorbar(aes(ymax=value+serr,ymin=value-serr),width=0.2,lwd=1)+
facet_wrap(~cluster_coarse,scales='free')+
theme(axis.text.x=element_blank())+ylab('Proportion tumor matching')
